<!--reference: https://www.sitepoint.com/get-url-parameters-with-javascript/ accessed August 2022-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BiaNova: Reset Your Password</title>
</head>
<body>
<label for="newPassword">New password:</label>
<input type="text" id="newPassword" name="newPassword"><br><br>
<input type="submit" value="Submit" onclick="password_reset()">
<div id="result">

</div>
<script>
    function password_reset() {
        let newPassword = document.getElementById("newPassword").value;
        const searchQuery= window.location.search;
        const token = new URLSearchParams(searchQuery).get("token");
        const username = new URLSearchParams(searchQuery).get("username");
        async function setNewPassword(url, data) {
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            return response.json();
        }
        setNewPassword('https://bianova.herokuapp.com/set_password', {"password": newPassword, "username": username}).then((data) => {
            document.getElementById("result").innerText = "Your password has been changed, you can close this tab."
            document.getElementById("newPassword").value="";
        });
    }
</script>
</body>
</html>